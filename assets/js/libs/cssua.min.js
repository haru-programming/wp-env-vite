import { filter } from 'underscore';

/**
 * CssUserAgent (cssua.js) v2.1.31 + refresh
 * http://cssuseragent.org
 * 
 * Copyright (c)2006-2015 Stephen M. McKamey.
 * Licensed under The MIT License.
 */
export const cssua=function(o,e,i){
    "use strict";var a=" ua-",w=/\s*([\-\w ]+)[\s\/\:]([\d_]+\b(?:[\-\._\/]\w+)*)/,f=/([\w\-\.]+[\s\/][v]?[\d_]+\b(?:[\-\._\/]\w+)*)/g,u=/\b(?:(blackberry\w*|bb10)|(rim tablet os))(?:\/(\d+\.\d+(?:\.\w+)*))?/,v=/\bsilk-accelerated=true\b/,x=/\bfluidapp\b/,g=/(\bwindows\b|\bmacintosh\b|\blinux\b|\bunix\b)/,h=/(\bandroid\b|\bipad\b|\bipod\b|\bwindows phone\b|\bwpdesktop\b|\bxblwp7\b|\bzunewp7\b|\bwindows ce\b|\bblackberry\w*|\bbb10\b|\brim tablet os\b|\bmeego|\bwebos\b|\bpalm|\bsymbian|\bj2me\b|\bdocomo\b|\bpda\b|\bchtml\b|\bmidp\b|\bcldc\b|\w*?mobile\w*?|\w*?phone\w*?)/,k=/(\bxbox\b|\bplaystation\b|\bnintendo\s+\w+)/,s={parse:function(e,i){var o={};if(i&&(o.standalone=i),!(e=(""+e).toLowerCase()))return o;for(var s,a,r=e.split(/[()]/),n=0,t=r.length;n<t;n++)if(n%2){var b=r[n].split(";");for(s=0,a=b.length;s<a;s++)if(w.exec(b[s])){var l=RegExp.$1.split(" ").join("_"),p=RegExp.$2;(!o[l]||parseFloat(o[l])<parseFloat(p))&&(o[l]=p)}}else{var d=r[n].match(f);if(d)for(s=0,a=d.length;s<a;s++){var c=d[s].split(/[\/\s]+/);c.length&&"mozilla"!==c[0]&&(o[c[0].split(" ").join("_")]=c.slice(1).join("-"))}}if(h.exec(e))o.mobile=RegExp.$1,u.exec(e)&&(delete o[o.mobile],o.blackberry=o.version||RegExp.$3||RegExp.$2||RegExp.$1,RegExp.$1?o.mobile="blackberry":"0.0.1"===o.version&&(o.blackberry="7.1.0.0"));else if(k.exec(e)){o.game=RegExp.$1;var m=o.game.split(" ").join("_");o.version&&!o[m]&&(o[m]=o.version)}else g.exec(e)&&(o.desktop=RegExp.$1);return(0<e.indexOf("android")&&-1==e.indexOf("mobile")||0<e.indexOf("ipad")||0<e.indexOf("kindle")||0<e.indexOf("silk"))&&(o.tablet=!0),o.intel_mac_os_x?(o.mac_os_x=o.intel_mac_os_x.split("_").join("."),delete o.intel_mac_os_x):o.cpu_iphone_os?(o.ios=o.cpu_iphone_os.split("_").join("."),delete o.cpu_iphone_os):o.cpu_os?(o.ios=o.cpu_os.split("_").join("."),delete o.cpu_os):"iphone"!==o.mobile||o.ios||(o.ios="1"),o.opera&&o.version?(o.opera=o.version,delete o.blackberry):v.exec(e)?o.silk_accelerated=!0:x.exec(e)&&(o.fluidapp=o.version),o.edge&&(delete o.applewebkit,delete o.safari,delete o.chrome,delete o.android),o.applewebkit?(o.webkit=o.applewebkit,delete o.applewebkit,o.opr&&(o.opera=o.opr,delete o.opr,delete o.chrome),o.safari&&(o.chrome||o.crios||o.fxios||o.opera||o.silk||o.fluidapp||o.phantomjs||o.mobile&&!o.ios?(delete o.safari,o.vivaldi&&delete o.chrome):o.version&&!o.rim_tablet_os?o.safari=o.version:o.safari={419:"2.0.4",417:"2.0.3",416:"2.0.2",412:"2.0",312:"1.3",125:"1.2",85:"1.0"}[parseInt(o.safari,10)]||o.safari)):o.msie||o.trident?(o.opera||(o.ie=o.msie||o.rv),delete o.msie,delete o.android,o.windows_phone_os?(o.windows_phone=o.windows_phone_os,delete o.windows_phone_os):"wpdesktop"!==o.mobile&&"xblwp7"!==o.mobile&&"zunewp7"!==o.mobile||(o.mobile="windows desktop",o.windows_phone=+o.ie<9?"7.0":+o.ie<10?"7.5":"8.0",delete o.windows_nt)):(o.gecko||o.firefox)&&(o.gecko=o.rv),o.rv&&delete o.rv,o.version&&delete o.version,o},format:function(e){function i(e,i){var o;return e=e.split(".").join("-"),a+e}var o="";for(var s in e)s&&e.hasOwnProperty(s)&&(o+=i(s,e[s]));return o},encode:function(e){},refresh:function(e){if(s.UA!=e){s.UA=e,s.userAgent=s.ua=s.parse(s.UA,navigator.standalone);var e=s.format(s.ua)+" ";if(o.className){var i=filter(o.className.split(" "),function(e){return-1==e.indexOf("ua-")});o.className=e.substr(1)+i.join(" ")}else o.className=e.substr(1)}}};s.UA=e,s.userAgent=s.ua=s.parse(e,i);var r=s.format(s.ua)+" js";return o.className?o.className=o.className.replace(/\bno-js\b/g,"")+r:o.className=r.substr(1),s
}(document.documentElement,navigator.userAgent,navigator.standalone);

//ブラウザback 対策
if(cssua.ua.ios){
	window.onpageshow = function(evt) {
		if (evt.persisted) {
			location.reload();
		}
	};
}